<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>16-TILE PUZZLE</title>

<style>
:root{
  --bg:#0b1220;
  --panel:#111a2c;
  --text:#e9eefc;
  --line:rgba(255,255,255,.12);
}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
  background:var(--bg);
  color:var(--text);
}
.wrap{max-width:900px;margin:40px auto;padding:20px}
h1{margin:0 0 10px}
.board{
  position:relative;
  width:100%;
  aspect-ratio:1/1;
  border-radius:16px;
  overflow:hidden;
  background:url("./images/puzzle.png") center/cover no-repeat;
  border:1px solid var(--line);
}
.tile{
  position:absolute;
  width:25%;
  height:25%;
  background:rgba(0,0,0,.6);
  border:1px solid var(--line);
  cursor:pointer;
  transition:opacity .5s ease, transform .5s ease;
}
.tile.revealed{
  opacity:0;
  transform:translateY(10px);
  pointer-events:none;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal.show{display:flex}
.box{
  background:var(--panel);
  padding:20px;
  border-radius:16px;
  width:300px;
}
input{
  width:100%;
  padding:10px;
  margin-top:10px;
}
button{
  margin-top:10px;
  padding:8px 12px;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="wrap">
  <h1>16-TILE PUZZLE</h1>
  <p>Ï†ïÎãµÏùÑ ÎßûÌûàÎ©¥ ÌÉÄÏùºÏù¥ Ïó¥Î¶ΩÎãàÎã§.</p>
  <div class="board" id="board"></div>
</div>

<div class="modal" id="modal">
  <div class="box">
    <div id="modalTitle">ÌÉÄÏùº</div>
    <input id="answerInput" placeholder="Ï†ïÎãµ ÏûÖÎ†•">
    <button id="submitBtn">ÏûÖÎ†•</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

/* üî• Ïó¨Í∏∞ ÎÑ§ Firebase ÏÑ§Ï†ïÍ∞í ÎÑ£Ïñ¥ */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const board = document.getElementById("board");
const modal = document.getElementById("modal");
const input = document.getElementById("answerInput");
const btn = document.getElementById("submitBtn");
let currentId = null;
let currentAnswer = "";

function id2(i){ return String(i).padStart(2,"0"); }

function position(i){
  const r = Math.floor((i-1)/4);
  const c = (i-1)%4;
  return { top:`${r*25}%`, left:`${c*25}%` };
}

async function loadBoard(){
  for(let i=1;i<=16;i++){
    const id = id2(i);
    const tile = document.createElement("div");
    tile.className="tile";
    tile.dataset.id=id;

    const pos=position(i);
    tile.style.top=pos.top;
    tile.style.left=pos.left;

    tile.onclick = async()=>{
      const ref = doc(db,"game","season1","slots",id);
      const snap = await getDoc(ref);
      if(!snap.exists()) return;

      const data=snap.data();
      currentId=id;
      currentAnswer=(data.answer||"").trim();

      if(data.claimed){
        tile.classList.add("revealed");
        return;
      }

      modal.classList.add("show");
      input.value="";
      input.focus();
    };

    board.appendChild(tile);

    // Ï¥àÍ∏∞ claimed Î∞òÏòÅ
    const ref = doc(db,"game","season1","slots",id);
    const snap = await getDoc(ref);
    if(snap.exists() && snap.data().claimed){
      tile.classList.add("revealed");
    }
  }
}

btn.onclick=async()=>{
  const val=input.value.trim();
  if(val.toLowerCase()===currentAnswer.toLowerCase()){
    const ref = doc(db,"game","season1","slots",currentId);
    await updateDoc(ref,{claimed:true});
    document.querySelector(`.tile[data-id="${currentId}"]`)
      .classList.add("revealed");
    modal.classList.remove("show");
  }
};

modal.onclick=(e)=>{
  if(e.target===modal) modal.classList.remove("show");
};

loadBoard();
</script>
</body>
</html>
